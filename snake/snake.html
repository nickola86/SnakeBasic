<!DOCTYPE HTML><html>  <head>  <script type="text/javascript" src="../commons/js/jquery-1.7.1.min.js"></script>  <script type="text/javascript" src="../commons/js/jquery-ui-1.8.17.custom.min.js"></script>  <script>        var xPos = 0;    var yPos = 0;    var direction = 'right';    var maxWidth;     var maxHeight;      var squareSize = 20;     var xRandom;    var yRandom;     var timer;     var snakeX = [0,20,40,60,80];    var snakeY = [0,0,0,0,0];    var snakeSize = 5;    var interval = 120;    var punteggio = 0;    var livello = 0;    var stepCounter = 0;    var semaforo = false;    var finalSnakeX = [800, 820, 840, 860, 880, 900, 900, 900, 900, 880, 860, 840, 840, 840, 840, 840];    var finalSnakeY = [100, 100, 100, 100, 100, 100, 80, 60, 40, 40, 40, 40, 60, 80, 120, 140];        $(document).ready(function(){	                maxWidth  = parseInt($("#square").attr("width")); 	      maxHeight = parseInt($("#square").attr("height"));	      	      drawInitialSnake();	      generateRandomSquare();	              timer = setInterval(function(){step();}, interval);	      	      $(document).keyup(function(e){catchArrowKeydown(e.keyCode)});                $("#pauseRestart").click(function(){pauseRestart();});    });           function drawInitialSnake(){          for (var i = 0; i<snakeSize; i++){        drawSquare("#AE1", snakeX[i], snakeY[i]);      }      }        function drawFinalSnake(){          for (var i = 0; i<finalSnakeX.length; i++){        drawSquare("#AE1", finalSnakeX[i], finalSnakeY[i]);      }      }            function endGame(){          var canvas = document.getElementById("square");      var context = canvas.getContext("2d");            context.fillStyle = "#FFF";      context.fillRect(0, 0, maxWidth, maxHeight);            context.fillStyle = '#000';      context.font = "100px Georgia";      context.fillText("Game Over", 240, 200);            var punteggio = $("#count").html();       var livello =  $("#interval").html();            var riepilogo1 = "Il tuo punteggio: " + punteggio + " punti";        var riepilogo2 = "Livello raggiunto: " + livello;            context.fillStyle = '#000';      context.font = "25px Georgia";      context.fillText(riepilogo1, 350, 280);      context.fillText(riepilogo2, 350, 320);            drawFinalSnake();            context.fillStyle = "#f7013e";      context.fillRect(845, 160, 10, 10);          }        function updateDataModel(){           xStr = "";       yStr = "";              for (i = 0; i<=snakeSize-2; i++){                 snakeX[i] = snakeX[i+1];          snakeY[i] = snakeY[i+1];       }              snakeX[snakeSize-1] = xPos;       snakeY[snakeSize-1] = yPos;              for (i = 0 ; i < snakeSize -1 ; i++){               xStr = xStr + " " + snakeX[i];        yStr = yStr + " " + snakeY[i];       }    }        function calcoloPosFutura(){          x = snakeX[snakeSize-1];      y = snakeY[snakeSize-1];            gameOver = false;            if (direction == 'right'){              x = x + squareSize;                if (x >= maxWidth)          gameOver = true;                } else if (direction == 'left'){              x = x - squareSize;                if (x < 0)          gameOver = true;                } else if (direction == 'up'){              y = y - squareSize;              if (y < 0)          gameOver = true;                } else if (direction == 'down'){                y = y + squareSize;                if (y >= maxHeight)          gameOver = true;      }             xPos = x;      yPos = y;              return gameOver;    }        function checkIsInSnake(x,y){          for (i=0;i<snakeSize-1; i++){                  if (snakeX[i] == x && snakeY[i] == y)            return true;      }            return false;    }          function eraseFirstSquare(){          var canvas = document.getElementById("square");      var context = canvas.getContext("2d");            context.strokeStyle="#FFFFFF";      context.strokeRect(snakeX[0], snakeY[0], squareSize, squareSize);            context.fillStyle = "#FFFFFF";       context.fillRect(snakeX[0], snakeY[0], squareSize, squareSize);          }         function drawSquare(color, x, y){            var canvas = document.getElementById("square");      var context = canvas.getContext("2d");            context.lineWidth = 3;      context.strokeStyle = "#FFF";      context.strokeRect(x, y, squareSize, squareSize);            context.fillStyle = color;       context.fillRect(x, y, squareSize, squareSize);          }                        function pauseRestart(){          var pauseRestart = $("#pauseRestart").val();      if (pauseRestart == "Pausa"){              clearInterval(timer);        $("#pauseRestart").val("Riprendi");            } else {                timer = setInterval(function(){step();}, interval);        $("#pauseRestart").val("Pausa");      }    }        function step(){          stepCounter++;      if (stepCounter%200 == 0 && interval > 50){              interval = interval - 10;        livello++;        $("#interval").html(livello);                clearInterval(timer);        timer = setInterval(function(){step();}, interval);              } else {              gameOver = calcoloPosFutura();                        if (gameOver == false)          mangiatoSnake = checkMangiatoSnake();                if (mangiatoSnake == false && gameOver == false){                  mangiato = checkMangiato();                    if (mangiato == true){                      snakeSize++;                        snakeX[snakeSize-1] = xPos;            snakeY[snakeSize-1] = yPos;                        drawSquare("#AE1", xPos, yPos);                        generateRandomSquare();                        punteggio++;            $("#count").html(punteggio);                } else {                      drawSquare("#AE1", xPos, yPos);            eraseFirstSquare();            updateDataModel();          }                  } else {                  clearInterval(timer);          endGame();                  }      }            semaforo = true;    }         function checkMangiatoSnake(){          found = false;            for (i = 0; i<snakeSize -1; i++){              if (snakeX[i] == xPos && snakeY[i] == yPos){            found = true;        }      }            return found;    }        function generateRandomSquare(){            do {              xRandom = Math.floor(Math.random() * maxWidth / squareSize) * squareSize;        yRandom = Math.floor(Math.random() * maxHeight / squareSize) * squareSize;                drawSquare("#FAA", xRandom, yRandom);            }  while (checkIsInSnake(xRandom,yRandom) == true)    }        function checkMangiato(){          if (xRandom == xPos && yRandom == yPos){              return true;                   } else {              return false;      }      }        function catchArrowKeydown(keyCode){           if (semaforo == true){		semaforo = false;              if (keyCode==37 && direction != 'right'){    		    		  direction = 'left';     		      		} else if (keyCode==38 && direction != 'down'){    			    			direction = 'up';                  		} else if (keyCode==39 && direction != 'left'){    			    			direction = 'right';      			    		} else if (keyCode==40 && direction != 'top'){    			    		  direction = 'down';     		}      }    }     </script>  </head>  <body>      <div style="text-align:center">    <canvas id="square" width="1000" height="500" style="border: 2px solid"></canvas>  </div>  <div style="text-align: center; margin-top: 10px; font-family: Georgia; font-size: 15px">     Punteggio:&nbsp;<span id="count">0</span>&nbsp;&nbsp;    Livello:&nbsp;<span id="interval">1</span>&nbsp;&nbsp;    <input type="button" id="pauseRestart" value="Pausa" style="padding: 5px"></input>  </div>    </body></html>